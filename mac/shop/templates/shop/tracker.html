<!--INHERITANCE DONE FOR basic.html FILE-->
{% extends 'shop/basic.html' %}

<!-- TITLE OF ABOUT PAGE-->
{% block title %} Tracker - My Awesome Cart {% endblock %}

<!-- BODY OF ABOUT PAGE-->
{% block body %}

<div class="container my-3">

  <div class="col">
      <h3><b>My Awesome Cart Tracker - Express Service <i class="fa-solid fa-truck-fast"></i></b></h3>
      <div class="my-2">
      <form class="row g-3" method="post" action="#" id="trackerForm"> {% csrf_token %}
        <div class="col-md-6">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" name="email" placeholder="Enter Email" required>
        </div>
        <div class="col-md-6">
          <label for="orderId" class="form-label">Order_ID</label>
          <input type="text" class="form-control" id="orderId" name="orderId" placeholder="Enter Order_ID" required>
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-outline-primary"><i class="fa-solid fa-location-dot"></i> <b>Track Order</b></button>
        </div>
      </form>
      </div>
  </div>

  <div class="col my-3">
      <h3><b>My Awesome Cart Tracker - Your Order Status</b></h3>
      <div class="my-3">
          <ol id="items" class="list-group list-group-numbered">
          </ol>
      </div>
  </div>

  <div class="col my-3">
      <h3><b>My Awesome Cart Tracker - Your Order Details</b></h3>
      <div class="my-3">
          <ol id="detail" class="list-group list-group-numbered">
          </ol>
      </div>
  </div>

</div>

{% endblock %}

{% block js %}
<script>

    $('#trackerForm').submit(function(event){

        $('#items').empty();
        $('#detail').empty();
        var formData = {
            'email': $('input[name=email]').val(),
            'orderId': $('input[name=orderId]').val(),
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        };
        $.ajax({
            type: 'POST',
            url: '/shop/tracker/',
            data: formData,
            encode: true
        })

        .done(function(data){
            // console.log(data);
            data = JSON.parse(data);
            updates = data[0];

            if(updates.length>0 & updates!={}){
                for(i=0; i<updates.length; i++){
                  let text = updates[i]['text'];
                  let time = updates[i]['time'];

                  mystr = `<ul class="list-group-item d-flex justify-content-between align-items-start">
                             <div class="fw-bold ms-2 me-auto">${text}</div>
                             <span class="badge bg-primary rounded-pill">${time}</span>
                           </ul>`
                  $('#items').append(mystr);
                }
            }
            else{
                mystr = `<div class='mx-5 my-4 '><b>Error :<br> Invalid Credentials.<br>Make Sure To Give Correct Credentials To Fetch Your Order Status.</b></div>`
                $('#items').append(mystr);
            }

            cart = JSON.parse(data[1]);
            console.log(cart);

            for(item in cart){
              let qty = cart[item][0];
              let name = cart[item][1];

              mystr = `<li class="list-group-item d-flex justify-content-between align-items-start">
                         <div class="fw-bold ms-2 me-auto">${name}</div>
                         <span class="badge bg-primary rounded-pill">${qty}</span>
                       </li>`
              $('#detail').append(mystr);
            }

        })

        event.preventDefault();

        $("#email").val("");
        $("#orderId").val("");

    });

</script>
{% endblock %}

<!--SO BY THIS WE ARE WORKING WITH DRY PRINCIPLE - DO NOT REPEAT YOURSELF-->
<!--AND SAVES TIME, EFFORT, MEMORY-->